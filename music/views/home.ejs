<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‰ªô‰∫∫music</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
.track-card {
  transition: transform .2s, box-shadow .2s;
}
.track-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 25px rgba(0,0,0,.15);
}

.fav-pop {
  animation: pop .4s ease;
}
@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.4); }
  100% { transform: scale(1); }
}

.alert {
  animation: slideFade .3s ease forwards;
}
@keyframes slideFade {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body class="bg-gradient-to-b from-gray-100 to-gray-200 min-h-screen">

<header class="p-4 bg-white/90 backdrop-blur shadow flex gap-2 sticky top-0 z-10">
  <form action="/music/s" method="get" class="flex w-full gap-2">
    <input
      name="q"
      value="<%= query === '__FAVORITES__' ? '' : query %>"
      placeholder="Êõ≤„ÇíÊé¢„Åô"
      class="flex-1 border rounded-xl p-2 focus:ring-2 focus:ring-blue-400"
    >
    <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 rounded-xl transition">
      üîç
    </button>
  </form>
  <button
    onclick="showFavorites()"
    class="bg-yellow-400 hover:bg-yellow-500 px-4 rounded-xl transition"
  >
    ‚≠ê
  </button>
</header>

<main id="content" class="p-4 space-y-4 max-w-3xl mx-auto">

<% tracks.forEach(track => { %>
  <div class="track-card bg-white p-4 rounded-2xl shadow flex gap-4 items-center">
    <img src="<%= track.artwork_url %>" class="w-20 h-20 rounded-xl object-cover">

    <div class="flex-1">
      <p class="font-bold"><%= track.title %></p>
      <p class="text-sm text-gray-500"><%= track.username %></p>
    </div>

    <button
      onclick="playTrack('<%= track.id %>','<%= track.title %>','<%= track.artwork_url %>')"
      class="bg-gradient-to-br from-blue-500 to-indigo-500
      text-white w-12 h-12 rounded-full hover:scale-110 transition shadow-lg">
      ‚ñ∂
    </button>

    <button
      onclick="favoriteWithAlert(this,'<%= track.artwork_url %>','<%= track.title %>','<%= track.id %>')"
      class="text-2xl transition hover:scale-125">
      ‚ù§Ô∏è
    </button>
  </div>
<% }) %>

</main>

<div id="player-bar"
  class="hidden fixed bottom-4 left-1/2 -translate-x-1/2
  bg-white rounded-2xl shadow-2xl border w-[95%] max-w-3xl p-3 z-50">
  <p id="player-title" class="font-bold text-sm mb-1 truncate"></p>
  <iframe id="player-frame" class="w-full h-24 rounded-xl"></iframe>
</div>

<div id="alert-area" class="fixed bottom-6 right-6 space-y-2 z-50"></div>

<!-- ‚òÖ musicÁî®JSÔºàË∂ÖÈáçË¶ÅÔºâ -->
<script src="/music/app.js"></script>

<script>
function favoriteWithAlert(btn, art, title, id) {
  toggleFavorite(art, title, id);

  btn.classList.add("fav-pop");
  setTimeout(() => btn.classList.remove("fav-pop"), 400);

  const alert = document.createElement("div");
  alert.className =
    "alert bg-black/80 text-white px-4 py-2 rounded-xl shadow-lg text-sm";
  alert.textContent = "‚≠ê „ÅäÊ∞ó„Å´ÂÖ•„ÇäÁôªÈå≤„Åó„Åü„ÇàÔºÅ";

  document.getElementById("alert-area").appendChild(alert);

  setTimeout(() => {
    alert.style.opacity = "0";
    setTimeout(() => alert.remove(), 300);
  }, 2000);
}
</script>

</body>
</html>
