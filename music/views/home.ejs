<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä»™äººmusic</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* ã‚«ãƒ¼ãƒ‰ hover */
.track-card {
  transition: transform .2s, box-shadow .2s;
}
.track-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 25px rgba(0,0,0,.15);
}

/* ãŠæ°—ã«å…¥ã‚Šã‚¢ãƒ‹ãƒ¡ */
.fav-pop {
  animation: pop .4s ease;
}
@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.4); }
  100% { transform: scale(1); }
}

/* ã‚¢ãƒ©ãƒ¼ãƒˆ */
.alert {
  animation: slideFade .3s ease forwards;
}
@keyframes slideFade {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>
</head>

<body class="bg-gradient-to-b from-gray-100 to-gray-200 min-h-screen">

<header class="p-4 bg-white/90 backdrop-blur shadow flex gap-2 sticky top-0 z-10">
<form action="/music/s" method="get" class="flex w-full gap-2">
<input name="q" value="<%= query === '__FAVORITES__' ? '' : query %>"
 placeholder="æ›²ã‚’æ¢ã™"
 class="flex-1 border rounded-xl p-2 focus:ring-2 focus:ring-blue-400">
<button class="bg-blue-500 hover:bg-blue-600 text-white px-4 rounded-xl transition">ğŸ”</button>
</form>
<button onclick="showFavorites()"
 class="bg-yellow-400 hover:bg-yellow-500 px-4 rounded-xl transition">â­</button>
</header>

<main id="content" class="p-4 space-y-4 max-w-3xl mx-auto">

<% tracks.forEach(track => { %>
<div class="track-card bg-white p-4 rounded-2xl shadow flex gap-4 items-center">
<img src="<%= track.artwork_url %>" class="w-20 h-20 rounded-xl object-cover">
<div class="flex-1">
<p class="font-bold"><%= track.title %></p>
<p class="text-sm text-gray-500"><%= track.username %></p>
</div>

<button
 onclick="playTrack('<%= track.id %>','<%= track.title %>','<%= track.artwork_url %>')"
 class="bg-gradient-to-br from-blue-500 to-indigo-500
 text-white w-12 h-12 rounded-full
 hover:scale-110 transition shadow-lg">â–¶</button>

<button
 onclick="favoriteWithAlert(this,'<%= track.artwork_url %>','<%= track.title %>','<%= track.id %>')"
 class="text-2xl transition hover:scale-125">â¤ï¸</button>
</div>
<% }) %>

</main>

<div id="player-bar"
 class="hidden fixed bottom-4 left-1/2 -translate-x-1/2
 bg-white rounded-2xl shadow-2xl border w-[95%] max-w-3xl p-3 z-50">
<p id="player-title" class="font-bold text-sm mb-1 truncate"></p>
<iframe id="player-frame" class="w-full h-24 rounded-xl"></iframe>
</div>

<!-- ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="alert-area" class="fixed bottom-6 right-6 space-y-2 z-50"></div>

<script src="/app.js"></script>

<!-- è¿½åŠ JS -->
<script>
function favoriteWithAlert(btn, art, title, id) {
  // æ—¢å­˜æ©Ÿèƒ½ã¯ãã®ã¾ã¾å‘¼ã¶
  toggleFavorite(art, title, id)

  // ãƒœã‚¿ãƒ³ã‚¢ãƒ‹ãƒ¡
  btn.classList.add("fav-pop")
  setTimeout(() => btn.classList.remove("fav-pop"), 400)

  // ã‚¢ãƒ©ãƒ¼ãƒˆç”Ÿæˆ
  const alert = document.createElement("div")
  alert.className =
    "alert bg-black/80 text-white px-4 py-2 rounded-xl shadow-lg text-sm"
  alert.textContent = "â­ ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ã—ãŸã‚ˆï¼"

  document.getElementById("alert-area").appendChild(alert)

  // è‡ªå‹•å‰Šé™¤
  setTimeout(() => {
    alert.style.opacity = "0"
    setTimeout(() => alert.remove(), 300)
  }, 2000)
}
</script>

</body>
</html>
